## Context

当前 `/skills` 页面仅有标题与说明；Skills 的管理集中在全局设置页（应用 Skills + CLI 全局 Skills），并通过读取固定目录加载 SKILL.md。项目层面的技能（例如仓库内 `.codex/skills`）无法在应用内查看、导入或控制启用顺序，导致技能与项目上下文脱节。项目数据已通过 `projects` 表与 `useProjects` 管理，并且任务执行会传递 `skillsConfig` 到 agent。

## Goals / Non-Goals

**Goals:**
- 在项目维度发现与管理 Skills，复用全局 Skills 的交互（列表、打开目录、删除、刷新、GitHub 导入）。
- 将项目 Skills 与任务执行绑定，确保项目技能优先于全局技能加载。
- 支持多 CLI 运行时的项目技能目录（例如 `.<cli>/skills`），并提供清晰的空状态与当前项目信息。
- 在不引入新技能格式的前提下，复用现有解析逻辑与文件操作接口。

**Non-Goals:**
- 新建技能编辑器或在线技能市场。
- 修改 SKILL.md 的结构或 CLI 的技能加载协议。
- 自动跨团队同步项目技能（仅依赖仓库本身的版本控制）。

## Decisions

- **项目技能来源路径与优先级**
  - 方案：以项目根目录为基准，读取 `.<cli>/skills`（与全局 CLI 目录对应的运行时列表）及 `.vibework/skills` 作为项目技能来源；优先级为「项目 > 应用 > 用户/CLI 全局」。
  - 理由：保证项目技能在执行时具备更高优先级，并保持与现有 CLI 目录结构一致。
  - 替代方案：仅使用全局目录并给技能打标签（不可分享且缺少项目隔离）。

- **项目技能配置存储**
  - 方案：在项目数据中保存 `skills` 配置（启用开关、覆盖/追加路径、是否包含全局技能），建议扩展 `projects` 表的 JSON 字段或新增 `project_settings` 表。
  - 理由：与现有项目管理一致，便于在 UI 与任务执行层直接读取。
  - 替代方案：写入项目目录 `.vibework/skills.json`（可被 Git 管理，但会引入文件冲突与权限问题）。

- **技能列表加载与 UI 复用**
  - 方案：抽离 `SkillsSettings` 中的目录扫描、SKILL.md frontmatter 解析与文件操作逻辑，供 `/skills` 页面复用；项目目录内技能可删除，CLI 全局目录只读。
  - 理由：降低重复实现成本，保持体验一致。
  - 替代方案：为项目页重写加载逻辑（维护成本更高）。

- **Agent 注入项目技能**
  - 方案：扩展 `skillsConfig` 结构，增加 `projectSkills`（路径列表与启用开关），在任务执行时基于当前 `projectId` 计算并注入。
  - 理由：无需改动用户提示与任务逻辑，保持现有调用链。
  - 替代方案：在 agent 侧推断项目路径（上下文不足且不可控）。

## Risks / Trade-offs

- [Risk] 扫描多个目录导致加载耗时增加 → Mitigation: 复用 `maxDepth` 限制与缓存；仅在用户触发刷新时重新扫描。
- [Risk] 删除项目技能会影响仓库文件 → Mitigation: 明确删除确认与路径提示，限制删除仅在项目目录内生效。
- [Risk] 项目技能与全局技能冲突 → Mitigation: 统一优先级策略并在 UI 标注来源。

## Migration Plan

- 数据迁移：若新增 `projects.config` 或 `project_settings` 表，为现有项目写入默认空配置。
- 代码切换：先实现项目页读取与展示，再接入导入/删除与 agent 注入能力。
- 回滚：保留全局 Skills 逻辑不变，项目级配置缺失时回退为仅使用全局技能。

## Open Questions

- 是否需要提供「从全局复制」与「软链接到项目」的两种策略？
- 项目级技能默认启用哪些运行时目录？是否跟随当前任务选择的 CLI runtime？
- 项目级配置是否需要导出到仓库文件以便团队共享？
