## Context

任务详情页右侧目前只有预览容器，缺少可用的文件入口；任务产物仅从消息中提取，且文本/代码类文件常因缺少 content 而无法预览。现有 Electron 文件系统 API 已支持 readDir/readTextFile/stat，可用于补齐文件列表与内容加载。

## Goals / Non-Goals

**Goals:**
- 在右侧“文件预览”补齐文件列表（任务产物 + 工作目录）并支持选择预览。
- 文本/代码/Markdown/CSV 等类型在仅有 path 时可自动读取内容并预览。
- 提供一致的加载/空态/错误态与基础操作入口（刷新、打开外部、打开编辑器、复制路径）。

**Non-Goals:**
- 不实现完整 IDE 文件管理（重命名/删除/编辑/搜索替换）。
- 不进行深度索引或实时文件监听（避免性能与复杂度）。
- 不扩展超过 50MB 的内置预览限制。

## Decisions

1) **文件列表结构**
- 在“文件预览”内加入列表面板，分为「任务产物」与「工作目录」两组。
- 任务产物使用现有 artifacts（从消息提取/数据库加载）；工作目录使用 `workingDir` 读取目录树。
- 列表与预览在同一视图内分栏，使用可折叠/滚动的轻量文件树。

2) **目录读取策略**
- 初始仅加载根目录的浅层（maxDepth=1~2），展开目录时按需读取子目录。
- 提供“刷新”动作以重新拉取目录结构；无 workingDir 时显示空态。

3) **统一 Artifact 模型**
- 列表项统一映射为 Artifact：`{ id, name, type, path }`。
- 预览时再懒加载文本内容，不直接在列表阶段读取文件。

4) **文本类内容加载**
- 在 `ArtifactPreview` 内对 text/code/markdown/csv/json/html 等类型，如果 `content` 为空且存在 `path`，则先 `fs.stat` 检查大小，再 `fs.readTextFile` 读取内容。
- 超过 `MAX_PREVIEW_SIZE` 时设置 `fileTooLarge` 并显示统一提示。

5) **兼容性与退路**
- Electron API 不可用时，继续使用已有 API fallback（若存在）；否则展示错误态而非崩溃。

## Risks / Trade-offs

- **[目录过大导致加载慢]** → 限制初始深度 + 按需展开，提供刷新与错误提示。
- **[文本文件过大造成内存压力]** → 维持 50MB 上限并显示“过大不可预览”。
- **[文件删除/移动导致预览失败]** → 预览失败时显示可恢复错误态与重试。

## Migration Plan

- 纯前端改动，无数据迁移；灰度发布时仅影响任务详情页右侧预览。

## Open Questions

- 任务产物是否需要从数据库补全（非消息来源）？若需要，后续加入数据层支持。
